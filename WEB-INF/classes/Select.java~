// Servlet Test.java  de test de la configuration
import java.io.*;
import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.annotation.WebServlet;
import java.sql.*;
import java.util.*;

@WebServlet("/servlet/Select")
public class Select extends HttpServlet
{
  public void service( HttpServletRequest req, HttpServletResponse res) throws ServletException, IOException {
      PrintWriter out = res.getWriter();
    
      Connection con=null;
      
      try {
	  res.setContentType("text/html");
	  Class.forName("org.postgresql.Driver");
       
	  String table=req.getParameter("table");
	  String url="jdbc:postgresql://sqlserv/da2i";
	  String nom = "deleruea";
	  String pass = "moi";
	    
	  con = DriverManager.getConnection(url,nom,pass);
	  DatabaseMetaData info = con.getMetaData();

	  //Requête
	  Statement stmt = con.createStatement();

	  ResultSet rs = stmt.executeQuery("SELECT * FROM "+table);
	  
	  ResultSet rs_meta = info.getColumns(con.getCatalog(), "deleruea", table, "%");	 	  
	  ResultSetMetaData rsmd_meta = rs_meta.getMetaData(); 
	  
	  out.print("<body>");


	  //Récupération des colonnes de la table
	  ArrayList<String> colonnes = new ArrayList<String>();
       	  while(rs_meta.next()) {
	      colonnes.add(rs_meta.getString("COLUMN_NAME"));
	  }

	  //Création tableau
	  out.println("<table border=1>");
	  out.println("<tr>");
	  for(int i=0; i<colonnes.size(); i++)  {
	      out.println("<td><strong>"+colonnes.get(i)+"</strong><td>");
	  }
	  out.println("</tr>");

	  boolean inversion_couleur=false;
	  while(rs.next()) {
	      if(!inversion_couleur) {
		  out.println("<tr bgcolor=green>");
		  inversion_couleur=true;
	      } else {
		  out.println("<tr bgcolor=blue>");
		  inversion_couleur=false;
	      }
	      for(int i=0; i<colonnes.size(); i++) {
		 
		  out.println("<td>"+rs.getString(colonnes.get(i)));
	      }
	      out.println("</tr>");
		  
	  }
	      
	  out.println("</table>");
	  out.println("</body>");
	  con.close();
      } catch (Exception e) {
      } finally {
	  try {
	      con.close();
	  } catch (Exception e) {
	      e.printStackTrace();
	  }
      }
  }
}